<!DOCTYPE html>
<html>
  <head>
    <title>Parcel Sandbox</title>
    <meta charset="UTF-8" />
  </head>

  <body>
    <input id="whatToDo" placeholder="what to do" />
    <button onclick="add()">create</button>

    <br />

    // entries go here
    <ul class="entries"></ul>

    <a href="archive.html">archive</a>
    <script>
      // parse todo_str to todo_items
      let todo_items = [];

      // loading data from localstorage to JS
      function loadData() {
        let todo_str = localStorage.getItem("todoList");
        if (todo_str && todo_str !== "") {
          todo_items = [];
          let items = todo_str.split(";");
          // "text;done;" --> "["text","done",""]"
          // still to do: set item to "open" by default

          // debugger;
          for (let i = 0; i < items.length - 1; i += 2) {
            const text = items[i];
            const done = items[i + 1] === "done" ? true : false;
            // array
            todo_items.push([text, done]);
          }
        }
      }

      function saveData() {
        let data = "";
        // [[text,done]]
        for (let i = 0; i < todo_items.length; i++) {
          const done = todo_items[i][1] ? "done" : "open";
          data += todo_items[i][0] + ";" + done + ";";
        }
        // string
        localStorage.setItem("todoList", data);
      }

      /*
            (a) todos: “text;<state>”;“text;<state>”;
            (b) archived: “text;<state>;”
      */
      function markAsDone() {
        //will use remove
        //will change state of todo to done
        //will update localstorage "todoList"
      }

      //a
      function archive() {
        //will archive item from to_do item or done list
      }

      function remove() {
        //will use remove from local_storage or DOM
      }

      function add() {
        const text_input = document.getElementById("whatToDo");

        if (text_input.value !== "") {
          // add data to todo_items
          todo_items.push([text_input.value, false]);
          // save data to local storage / update local storage
          //
          saveData();

          // append to DOM
          append(todo_items[todo_items.length - 1]);
        }
      }

      function append(todoEntry) {
        // li
        const li = document.createElement("li");
        li.classList.add("entry");

        // label
        const label = document.createElement("label");
        label.for = "tE1";
        li.appendChild(label);

        // input
        const input = document.createElement("input");
        input.id = "tE2";
        input.value = todoEntry[0];
        li.appendChild(input);

        // buttons
        const button_edit = document.createElement("button");
        button_edit.innerHTML = "edit";
        li.appendChild(button_edit);

        const button_done = document.createElement("button");
        button_done.innerHTML = "done";
        button_done.onclick = function (e) {
          input.toggleAttribute("readonly");
          todoEntry[1] = !todoEntry[1];
          saveData();
          // also: move item to done list?
        };
        if (todoEntry[1]) {
          // if supposed to be done
          button_done.onclick();
        }
        li.appendChild(button_done);

        // form: should not be empty

        const button_archive = document.createElement("button");
        button_archive.innerHTML = "archive";
        li.appendChild(button_archive);

        const ul_list = document.getElementsByClassName("entries")[0];
        ul_list.appendChild(li);
      }

      // load data into to todo_items
      loadData();
      todo_items.forEach((element) => {
        // append only the "text" in the string
        append(element);
      });
    </script>
  </body>
</html>
